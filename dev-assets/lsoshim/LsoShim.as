/*	developer: Randy Troppmann	date:      May 26, 2011	used to cache twitter friends from web page*/package  {		import flash.display.MovieClip;	import flash.net.SharedObject;	import flash.external.ExternalInterface;	import flash.events.MouseEvent;	import flash.events.Event;			public class LsoShim extends MovieClip {		protected var lso:SharedObject;		public var animation:MovieClip;				public function LsoShim() {			ExternalInterface.call("lsoShimMessage", "LSO Shim initialized. version 1.0");			animation.visible = false;			animation.addEventListener(MouseEvent.CLICK, onClearClick, false, 0, true);			lso = SharedObject.getLocal("friends");			if (lso.data.date) ExternalInterface.call("lsoShimMessage", "date created: " + lso.data.date.toString());			else ExternalInterface.call("lsoShimMessage", "no LSO creation date");			var ageSeconds:Number = 0;			var now:Date = new Date();			if (lso.data.date) ageSeconds = Math.round((now.valueOf() - (lso.data.date as Date).valueOf())/1000);			if (ageSeconds > 21600){				//older than 6 hours				clearLSO();				ExternalInterface.call("lsoShimMessage", "lso friends data is old. Clearing cache. (age): " + ageSeconds);			}			ExternalInterface.addCallback("jsSetFriends", fromJavascriptSetFriends);			ExternalInterface.addCallback("jsGetFriends", fromJavascriptGetFriends);						ExternalInterface.addCallback("jsShowAnimation", showAnimation);			ExternalInterface.addCallback("jsHideAnimation", hideAnimation);					}						private function hideAnimation(){			animation.visible = false;					removeEventListener(Event.ENTER_FRAME, onOEF);		}				private function showAnimation(){			animation.visible = true;					addEventListener(Event.ENTER_FRAME, onOEF, false, 0, true);		}				private function onOEF(e:Event):void{			animation.rotation += 20;		}								private function saveFriends(p_friends:Array, p_username:String = ""):void{			lso.data.friendsArray = p_friends;			lso.data.username = p_username;			lso.data.date = new Date();			lso.flush();		}				private function retrieveFriendsObj():Object{			var fArray:Array = [];			var userN:String = "";			if (lso.data.friendsArray) fArray = lso.data.friendsArray;			if (lso.data.username) userN = lso.data.username;			return {friends:fArray, username:userN};					}				private function fromJavascriptSetFriends(p_friends:Array, p_username:String = ""):Boolean{			var success:Boolean = false;			if (p_friends){				saveFriends(p_friends, p_username);				success = true;			}			return success;		}						private function fromJavascriptGetFriends():Object{			return retrieveFriendsObj();		}				private function onClearClick(evt:MouseEvent):void{			clearLSO();			ExternalInterface.call("lsoShimMessage", "data cleared");		}				private function clearLSO():void{			lso.data.friendsArray = [];			lso.data.username = "";			lso.data.date = null;			lso.flush();		}			}}